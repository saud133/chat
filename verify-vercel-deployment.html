<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vercel Deployment Verification</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2d3748;
            margin-bottom: 10px;
        }
        .header p {
            color: #718096;
            font-size: 1.1em;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-card {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .test-card h3 {
            margin: 0 0 15px 0;
            color: #2d3748;
        }
        .status {
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 600;
            margin: 10px 0;
            display: inline-block;
        }
        .status.loading { background: #fef5e7; color: #d69e2e; }
        .status.success { background: #f0fff4; color: #38a169; }
        .status.error { background: #fed7d7; color: #e53e3e; }
        .response {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 200px;
            margin-top: 10px;
        }
        .dashboard-preview {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #4299e1;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #718096;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .users-table th,
        .users-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .users-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }
        .user-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .user-type.registered {
            background: #c6f6d5;
            color: #22543d;
        }
        .user-type.guest {
            background: #fed7d7;
            color: #742a2a;
        }
        .button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        .button:hover {
            background: #3182ce;
            transform: translateY(-1px);
        }
        .button.secondary {
            background: #718096;
        }
        .button.secondary:hover {
            background: #4a5568;
        }
        .verification-status {
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 1.2em;
            font-weight: 600;
        }
        .verification-status.success {
            background: #c6f6d5;
            color: #22543d;
        }
        .verification-status.error {
            background: #fed7d7;
            color: #742a2a;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Vercel Deployment Verification</h1>
            <p>Testing Dashboard API endpoints on Vercel</p>
            <p><strong>Live URL:</strong> <a href="https://chat-m3jt9enzm-saudgs-projects.vercel.app" target="_blank">https://chat-m3jt9enzm-saudgs-projects.vercel.app</a></p>
        </div>

        <div style="text-align: center; margin-bottom: 30px;">
            <button class="button" onclick="runAllTests()">üß™ Run All Tests</button>
            <button class="button secondary" onclick="clearResults()">üóëÔ∏è Clear Results</button>
            <button class="button secondary" onclick="openDashboard()">üìä Open Dashboard</button>
        </div>

        <div id="verification-status" class="verification-status" style="display: none;"></div>

        <div class="test-grid">
            <div class="test-card">
                <h3>üè• Health Check</h3>
                <div id="health-status" class="status loading">Ready to test</div>
                <div id="health-response" class="response" style="display: none;"></div>
            </div>

            <div class="test-card">
                <h3>üìä Usage Statistics</h3>
                <div id="usage-status" class="status loading">Ready to test</div>
                <div id="usage-response" class="response" style="display: none;"></div>
            </div>

            <div class="test-card">
                <h3>üë• Users Data</h3>
                <div id="users-status" class="status loading">Ready to test</div>
                <div id="users-response" class="response" style="display: none;"></div>
            </div>
        </div>

        <div id="dashboard-preview" class="dashboard-preview" style="display: none;">
            <h3>üìà Dashboard Preview</h3>
            <div id="stats-preview"></div>
            <div id="users-preview"></div>
        </div>
    </div>

    <script>
        const VERCEL_URL = 'https://chat-m3jt9enzm-saudgs-projects.vercel.app';
        let testResults = {};

        async function testEndpoint(name, url, resultKey) {
            const statusDiv = document.getElementById(`${resultKey}-status`);
            const responseDiv = document.getElementById(`${resultKey}-response`);
            
            statusDiv.className = 'status loading';
            statusDiv.textContent = `Testing ${name}...`;
            responseDiv.style.display = 'none';

            try {
                const startTime = Date.now();
                const response = await fetch(`${VERCEL_URL}${url}`);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = `‚úÖ ${name} - ${response.status} OK (${responseTime}ms)`;
                    responseDiv.textContent = JSON.stringify(data, null, 2);
                    responseDiv.style.display = 'block';
                    
                    testResults[resultKey] = { success: true, data: data };
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = `‚ùå ${name} - ${response.status} Error`;
                    responseDiv.textContent = JSON.stringify(data, null, 2);
                    responseDiv.style.display = 'block';
                    
                    testResults[resultKey] = { success: false, data: data };
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `‚ùå ${name} - Error: ${error.message}`;
                responseDiv.textContent = error.message;
                responseDiv.style.display = 'block';
                
                testResults[resultKey] = { success: false, error: error.message };
            }
        }

        async function runAllTests() {
            clearResults();
            
            await testEndpoint('Health Check', '/api/health', 'health');
            await testEndpoint('Usage Statistics', '/api/usage', 'usage');
            await testEndpoint('Users Data', '/api/usage/users', 'users');
            
            updateVerificationStatus();
            showDashboardPreview();
        }

        function updateVerificationStatus() {
            const statusDiv = document.getElementById('verification-status');
            const allSuccess = Object.values(testResults).every(result => result.success);
            
            if (allSuccess) {
                statusDiv.className = 'verification-status success';
                statusDiv.textContent = 'üéâ All tests passed! Dashboard should work correctly on Vercel.';
            } else {
                statusDiv.className = 'verification-status error';
                statusDiv.textContent = '‚ùå Some tests failed. Check the individual test results above.';
            }
            
            statusDiv.style.display = 'block';
        }

        function showDashboardPreview() {
            if (!testResults.usage?.success || !testResults.users?.success) {
                return;
            }

            const dashboardDiv = document.getElementById('dashboard-preview');
            const statsDiv = document.getElementById('stats-preview');
            const usersDiv = document.getElementById('users-preview');

            const stats = testResults.usage.data;
            const users = testResults.users.data;

            // Show stats cards
            statsDiv.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${stats.total_usage || 0}</div>
                        <div class="stat-label">Total Messages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.total_users || 0}</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.registered_users || 0}</div>
                        <div class="stat-label">Registered Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.guest_users || 0}</div>
                        <div class="stat-label">Guest Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.recent_activity || 0}</div>
                        <div class="stat-label">Recent Activity</div>
                    </div>
                </div>
            `;

            // Show users table
            usersDiv.innerHTML = `
                <h4>üë• User Activity</h4>
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Type</th>
                            <th>Messages</th>
                            <th>Last Activity</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td>${user.username}</td>
                                <td>
                                    <span class="user-type ${user.is_registered ? 'registered' : 'guest'}">
                                        ${user.is_registered ? 'Registered' : 'Guest'}
                                    </span>
                                </td>
                                <td>${user.usage_count}</td>
                                <td>${new Date(user.last_used_at).toLocaleString()}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            dashboardDiv.style.display = 'block';
        }

        function clearResults() {
            document.getElementById('verification-status').style.display = 'none';
            document.getElementById('dashboard-preview').style.display = 'none';
            
            ['health', 'usage', 'users'].forEach(key => {
                document.getElementById(`${key}-status`).className = 'status loading';
                document.getElementById(`${key}-status`).textContent = 'Ready to test';
                document.getElementById(`${key}-response`).style.display = 'none';
            });
            
            testResults = {};
        }

        function openDashboard() {
            window.open('https://chat-m3jt9enzm-saudgs-projects.vercel.app', '_blank');
        }

        // Auto-run tests on page load
        window.onload = () => {
            runAllTests();
        };
    </script>
</body>
</html>
