<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vercel Dashboard API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { background: #fff3cd; color: #856404; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 300px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .dashboard-preview {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .stat-card {
            display: inline-block;
            background: white;
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-width: 150px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>üß™ Vercel Dashboard API Test</h1>
    <p>This page tests the API endpoints that the Dashboard page uses on Vercel.</p>
    <p><strong>Live URL:</strong> <a href="https://chat-m3jt9enzm-saudgs-projects.vercel.app" target="_blank">https://chat-m3jt9enzm-saudgs-projects.vercel.app</a></p>

    <div class="test-section">
        <h2>API Endpoints Test</h2>
        <button onclick="testAll()">Test All Endpoints</button>
        <button onclick="clearResults()">Clear Results</button>
        <button onclick="testDashboard()">Test Dashboard Preview</button>
    </div>

    <div id="results"></div>

    <div id="dashboard-preview" class="dashboard-preview" style="display: none;">
        <h3>Dashboard Preview</h3>
        <div id="stats-preview"></div>
        <div id="users-preview"></div>
    </div>

    <script>
        const VERCEL_URL = 'https://chat-m3jt9enzm-saudgs-projects.vercel.app';

        async function testEndpoint(name, url) {
            const resultDiv = document.getElementById('results');
            const testDiv = document.createElement('div');
            testDiv.className = 'test-section';
            testDiv.innerHTML = `
                <h3>${name}</h3>
                <div class="status loading">Testing ${url}...</div>
                <pre id="result-${name.replace(/\s+/g, '-').toLowerCase()}"></pre>
            `;
            resultDiv.appendChild(testDiv);

            try {
                const response = await fetch(`${VERCEL_URL}${url}`);
                const data = await response.json();
                
                const statusDiv = testDiv.querySelector('.status');
                const resultPre = testDiv.querySelector('pre');
                
                if (response.ok) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = `‚úÖ ${name} - Status: ${response.status} OK`;
                    resultPre.textContent = JSON.stringify(data, null, 2);
                    
                    // Store data for dashboard preview
                    if (name === 'Usage Statistics') {
                        window.usageStats = data;
                    } else if (name === 'Users Data') {
                        window.usersData = data;
                    }
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = `‚ùå ${name} - Status: ${response.status} Error`;
                    resultPre.textContent = JSON.stringify(data, null, 2);
                }
            } catch (error) {
                const statusDiv = testDiv.querySelector('.status');
                const resultPre = testDiv.querySelector('pre');
                
                statusDiv.className = 'status error';
                statusDiv.textContent = `‚ùå ${name} - Error: ${error.message}`;
                resultPre.textContent = error.message;
            }
        }

        async function testAll() {
            clearResults();
            
            await testEndpoint('Health Check', '/api/health');
            await testEndpoint('Usage Statistics', '/api/usage');
            await testEndpoint('Users Data', '/api/usage/users');
        }

        function testDashboard() {
            if (!window.usageStats || !window.usersData) {
                alert('Please run "Test All Endpoints" first to load data');
                return;
            }

            const dashboardDiv = document.getElementById('dashboard-preview');
            const statsDiv = document.getElementById('stats-preview');
            const usersDiv = document.getElementById('users-preview');

            // Show stats cards
            statsDiv.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${window.usageStats.total_usage || 0}</div>
                    <div class="stat-label">Total Messages</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${window.usageStats.total_users || 0}</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${window.usageStats.registered_users || 0}</div>
                    <div class="stat-label">Registered Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${window.usageStats.guest_users || 0}</div>
                    <div class="stat-label">Guest Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${window.usageStats.recent_activity || 0}</div>
                    <div class="stat-label">Recent Activity</div>
                </div>
            `;

            // Show users table
            usersDiv.innerHTML = `
                <h4>User Activity</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 10px; text-align: left;">Username</th>
                            <th style="padding: 10px; text-align: left;">Type</th>
                            <th style="padding: 10px; text-align: left;">Messages</th>
                            <th style="padding: 10px; text-align: left;">Last Activity</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${window.usersData.map(user => `
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 10px;">${user.username}</td>
                                <td style="padding: 10px;">
                                    <span style="padding: 4px 8px; border-radius: 4px; background: ${user.is_registered ? '#d4edda' : '#f8d7da'}; color: ${user.is_registered ? '#155724' : '#721c24'};">
                                        ${user.is_registered ? 'Registered' : 'Guest'}
                                    </span>
                                </td>
                                <td style="padding: 10px;">${user.usage_count}</td>
                                <td style="padding: 10px;">${new Date(user.last_used_at).toLocaleString()}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            dashboardDiv.style.display = 'block';
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('dashboard-preview').style.display = 'none';
        }

        // Auto-test on page load
        window.onload = () => {
            testAll();
        };
    </script>
</body>
</html>
